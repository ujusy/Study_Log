# 리팩터링 ch 4

리팩터링 ch 4는 테스트 구축하기이다.

앞에서도 테스트를 강조하였는데 해당 챕터도 리팩토링하는데 있어서 , 코드를 작성하는데에 있어서 테스트가 얼마나 중요한지 어떻게 테스트를 해야할지를 설명하고있다.

해당 챕터는 `mocha` 테스트 프레임워크의 `describe`, `it` 을 사용하여 예시를 들어 설명하고있다.

음.. 이론적인 지식을 정리하기 보다는 해당 챕터를 읽으며 들었던 생각을 작성해보고자한다.

책의 저자인 마틴 파울러는 "완벽하게 만드느라 테스트를 수행하지 못하느니, 불완전한 테스트라도 작성해 실행하는 게 낫다."라고 말하고있다.

나도 이 말에 굉장히 공감한다. 프로젝트, 회사 일을 하면서 내가 완벽하다고 생각하면 작성한 API도 테스트 코드를 통해 오류를 잡은 경험이 많기 때문이다. 하지만 현업에서 테스트를 작성하면서 1시간 동안 API를 개발한다고하면 테스트를 작성하는데 2시간 이상이 걸리는 경우가 허다했다. 테스트의 중요성을 알지만 배보다 배꼽이 더 큰느낌이 간혹 들 때가 있었다.

하지만 리팩터링을 할 때는 테스트 코드가 방패가 되어주어 조금 더 내가 변경하고 있는 코드에 대한 신뢰성을 높여준다. 

현재 테스트를 작성할 때 정상 200 뜨는 테스트도 작성하지만 특히 예외처리가 (오류가 나야할 상황에서 오류가 나는가) 잘 되는지 를 중점으로 테스트를 작성하고있다. 책에서도 "실패해야 할 상황에서는 반드시 실패하게 만들자."라고 한다.

이 챕터에서 좀 집중에서 본 부분이 있는데 `beforeEach`에 관한 내용이었다. 지금까지는 하나의 `describe`에 하나의 `beforeEach`를 일반적으로 고수하고있었지만 최근에 한 프로젝트를 할 때 이러한 방식은 테스트(it)끼리의 의존성을 가지게 되는 것이 아닌가에 대한 의문으로 it 테스트마다 각각 pre data를 작성한 경험이 있다.

이 부분에 대해 작성이 간략하게 되어있는데 `beforeEach`를 사용하셔 표준 픽스처를 사용한다는 사실을 알려주고 코드를 읽는 사람들이 `describe` 블록 안의 모든 테스트가 똑같은 기준 데이터로부터 시작한다는 사실을 알 수 있게 해준다라고 한다.

이 부분에 대해 고민이 있었는데 마침 책에서 해결해주었다..ㅎㅎ 

챕터 4는 이론을 정리하기보다는 배운점(?)위주로 정리했고 테스트 작성 항상 너무 귀찮았는데 재미를 붙여봐야겠다..

